Object.defineProperty(exports,"__esModule",{value:true});var _jsxFileName='lib/index.js';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);var _reactNative=require('react-native');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Touchable=_reactNative.Platform.OS==='ios'?_reactNative.TouchableOpacity:_reactNative.TouchableNativeFeedback;var DEVICE_WIDTH=_reactNative.Dimensions.get('window').width;var Swiper=function(_Component){_inherits(Swiper,_Component);function Swiper(props){_classCallCheck(this,Swiper);var _this=_possibleConstructorReturn(this,(Swiper.__proto__||Object.getPrototypeOf(Swiper)).call(this,props));_this._responder=_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return false;},onStartShouldSetPanResponderCapture:function onStartShouldSetPanResponderCapture(){return false;},onMoveShouldSetPanResponder:function onMoveShouldSetPanResponder(){return true;},onPanResponderTerminationRequest:function onPanResponderTerminationRequest(){return false;},onMoveShouldSetPanResponderCapture:function onMoveShouldSetPanResponderCapture(){return true;},onPanResponderGrant:function onPanResponderGrant(){_this._position.setOffset(_this._positionValue);_this._position.setValue(0);_this.autoplayTimer&&clearTimeout(_this.autoplayTimer);_this.autoplayTimer=null;},onPanResponderMove:function onPanResponderMove(evt,_ref){var dx=_ref.dx;_this._position.setValue(-dx/_this.props.cardWidth);},onPanResponderRelease:function onPanResponderRelease(evt,_ref2){var vx=_ref2.vx;var childrenCount=_this.state.childrenCount;_this._position.flattenOffset();var result=void 0;if(vx>0.05){result=Math.floor(_this._positionValue);}else if(vx<-0.05){result=Math.ceil(_this._positionValue);}else{result=Math.round(_this._positionValue);}_this.animateToIndex(result);}});_this.animateToIndex=function(index){var animated=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var childrenCount=_this.state.childrenCount;var _this$props=_this.props,animateDuration=_this$props.animateDuration,onIndexChanged=_this$props.onIndexChanged;if(index<0){index=childrenCount-1;_this._position.setValue(_this._positionValue+childrenCount);}else if(index>childrenCount-1){index=0;_this._position.setValue(_this._positionValue-childrenCount);}_reactNative.Animated.timing(_this._position,{toValue:index,duration:animated?animateDuration:0}).start(function(){_this._updateDots(index);_this.$currentIndex=index;onIndexChanged(index);_this._setAutoplay();});};_this.goNext=function(){_this.autoplayTimer&&clearTimeout(_this.autoplayTimer);_this.autoplayTimer=null;_this.animateToIndex(_this.$currentIndex+1);};_this.goPre=function(){_this.autoplayTimer&&clearTimeout(_this.autoplayTimer);_this.autoplayTimer=null;_this.animateToIndex(_this.$currentIndex-1);};_this.positionValueUpdator=function(_ref3){var value=_ref3.value;_this._positionValue=value;};_this.init(props);return _this;}_createClass(Swiper,[{key:'init',value:function init(props){var initIndex=props.initIndex,children=props.children,containerWidth=props.containerWidth,cardWidth=props.cardWidth;this.$currentIndex=initIndex;this._positionValue=initIndex;this._position=new _reactNative.Animated.Value(initIndex);this._position.addListener(this.positionValueUpdator);var swingWidth=(containerWidth-cardWidth)/2;var childrenCount=_react2.default.Children.count(children);if(childrenCount<5){throw new Error('children count must more than 5');}if(!this.state){this.state=_extends({swingWidth:swingWidth,childrenCount:childrenCount},this._getRanges(children,swingWidth,childrenCount));}else{this.setState(_extends({swingWidth:swingWidth,childrenCount:childrenCount},this._getRanges(children,swingWidth,childrenCount)));}}},{key:'_getRanges',value:function _getRanges(children,swingWidth,childrenCount){var _props=this.props,radio=_props.radio,cardWidth=_props.cardWidth;var midCount=Math.floor(childrenCount/2);var n=childrenCount%2===0?0:-1;var obj=children.reduce(function(acc,_,index){var lessMid=index<=midCount;var zIndex=lessMid?midCount-index:index+n-midCount;var scale=Math.pow(radio,midCount-zIndex);var shrinkWith=(1-scale)*cardWidth/2;var offsetX=(shrinkWith+swingWidth*(1-Math.pow(radio,lessMid?index:midCount-zIndex))/(1-radio))/scale;var translateX=lessMid?offsetX:-offsetX;acc.zIndexs.push(zIndex+0.5);acc.scales.push(scale);acc.tranlateXs.push(translateX);return acc;},{zIndexs:[],scales:[],tranlateXs:[]});var result=Object.keys(obj).reduce(function(acc,k){if(k==='tranlateXs'){acc[k]=obj[k].slice(1).reverse().concat(obj[k].map(function(v){return-v;}));}else{acc[k]=obj[k].slice(1).reverse().concat(obj[k]);}return acc;},obj);return result;}},{key:'_getInputRange',value:function _getInputRange(index){var childrenCount=this.state.childrenCount;return new Array(childrenCount*2-1).fill().map(function(_,idx){return index+idx+1-childrenCount;});}},{key:'_updateDots',value:function _updateDots(index){var _props2=this.props,dotColor=_props2.dotColor,activeDotColor=_props2.activeDotColor,dots=_props2.dots;var preIndex=this.$currentIndex;if(dots){this.refs['dot'+preIndex].setNativeProps({style:{backgroundColor:dotColor}});this.refs['dot'+index].setNativeProps({style:{backgroundColor:activeDotColor}});}}},{key:'_setAutoplay',value:function _setAutoplay(){var _this2=this;var _props3=this.props,autoplay=_props3.autoplay,autoplayDirection=_props3.autoplayDirection,autoplayInterval=_props3.autoplayInterval;if(autoplay&&!this.autoplayTimer){this.autoplayTimer=setInterval(function(){var result=_this2.$currentIndex+(autoplayDirection?1:-1);_this2.animateToIndex(result);},autoplayInterval);}}},{key:'componentDidMount',value:function componentDidMount(){var initIndex=this.props.initIndex;this._position.setValue(initIndex);this._setAutoplay();this._updateDots(initIndex);}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){var initIndex=nextProps.initIndex,children=nextProps.children;if(this.props.children!==children||this.props.initIndex!==initIndex){this.init(nextProps);}}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(nextProps,nextState){return nextState.tranlateXs!==this.state.tranlateXs;}},{key:'componentWillUnmount',value:function componentWillUnmount(){this.autoplayTimer&&clearTimeout(this.autoplayTimer);this.autoplayTimer=null;this._position.removeListener(this.positionValueUpdator);}},{key:'render',value:function render(){var _this3=this;var _state=this.state,swingWidth=_state.swingWidth,zIndexs=_state.zIndexs,scales=_state.scales,tranlateXs=_state.tranlateXs;var _props4=this.props,children=_props4.children,containerWidth=_props4.containerWidth,cardHeight=_props4.cardHeight,dotColor=_props4.dotColor,activeDotColor=_props4.activeDotColor,cardWidth=_props4.cardWidth,dotsContainerWidth=_props4.dotsContainerWidth,dotsContainerBottom=_props4.dotsContainerBottom;var itemStyl={width:cardWidth,height:cardHeight,left:swingWidth};var containerStyl={width:containerWidth,height:cardHeight};var buttonStyl=[styles.button,{top:(cardHeight-40)/2}];var buttonTextStyl={color:activeDotColor,fontSize:40};return _react2.default.createElement(_reactNative.View,{__source:{fileName:_jsxFileName,lineNumber:239}},_react2.default.createElement(_reactNative.View,_extends({},this._responder.panHandlers,{style:[styles.container,containerStyl],__source:{fileName:_jsxFileName,lineNumber:240}}),_react2.default.Children.map(children,function(child,index){var inputRange=_this3._getInputRange(index);return _react2.default.createElement(_reactNative.Animated.View,{style:[styles.slide,itemStyl,{zIndex:_this3._position.interpolate({inputRange:inputRange,outputRange:zIndexs}),transform:[{scale:_this3._position.interpolate({inputRange:inputRange,outputRange:scales})},{translateX:_this3._position.interpolate({inputRange:inputRange,outputRange:tranlateXs})}]}],__source:{fileName:_jsxFileName,lineNumber:248}},child);}),this.props.dots&&_react2.default.createElement(_reactNative.View,{style:[styles.dots,{width:dotsContainerWidth,left:(containerWidth-dotsContainerWidth)/2,bottom:dotsContainerBottom}],__source:{fileName:_jsxFileName,lineNumber:269}},_react2.default.Children.map(children,function(_,index){return _react2.default.createElement(_reactNative.View,{key:index,ref:'dot'+index,style:[styles.dot,{backgroundColor:dotColor}],__source:{fileName:_jsxFileName,lineNumber:281}});}))),this.props.showsButtons&&[_react2.default.createElement(Touchable,{key:'pre',onPress:this.goPre,style:[buttonStyl,{left:10}],__source:{fileName:_jsxFileName,lineNumber:294}},_react2.default.createElement(_reactNative.Text,{style:buttonTextStyl,__source:{fileName:_jsxFileName,lineNumber:298}},'\u2039')),_react2.default.createElement(Touchable,{key:'next',onPress:this.goNext,style:[buttonStyl,{right:10}],__source:{fileName:_jsxFileName,lineNumber:300}},_react2.default.createElement(_reactNative.Text,{style:buttonTextStyl,__source:{fileName:_jsxFileName,lineNumber:304}},'\u203A'))]);}}]);return Swiper;}(_react.Component);exports.default=Swiper;Swiper.defaultProps={containerWidth:DEVICE_WIDTH,cardWidth:DEVICE_WIDTH*0.6,cardHeight:DEVICE_WIDTH*0.4,radio:0.8,initIndex:0,animateDuration:200,autoplay:false,autoplayInterval:3600,autoplayDirection:true,dotsContainerWidth:DEVICE_WIDTH*0.4,dotsContainerBottom:10,dotColor:'rgba(0,0,0,.2)',activeDotColor:'#007aff',dots:true,showsButtons:true,onIndexChanged:function onIndexChanged(){}};Swiper.propTypes={containerWidth:_propTypes2.default.number,cardWidth:_propTypes2.default.number,cardHeight:_propTypes2.default.number,radio:_propTypes2.default.number,initIndex:_propTypes2.default.number,animateDuration:_propTypes2.default.number,autoplay:_propTypes2.default.bool,autoplayInterval:_propTypes2.default.number,onIndexChanged:_propTypes2.default.func,autoplayDirection:_propTypes2.default.bool,dotsContainerBottom:_propTypes2.default.number,dotColor:_propTypes2.default.string,activeDotColor:_propTypes2.default.string,dots:_propTypes2.default.bool,showsButtons:_propTypes2.default.bool,children:_propTypes2.default.arrayOf(_propTypes2.default.node).isRequired};var styles=_reactNative.StyleSheet.create({container:{overflow:'hidden',position:'relative'},slide:{position:'absolute',top:0},dots:{position:'absolute',flexDirection:'row',justifyContent:'space-between',zIndex:999},dot:{width:8,height:8,borderRadius:4},button:{position:'absolute',zIndex:999,backgroundColor:'transparent'}});